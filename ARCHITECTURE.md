# Graham Analyzer - –ò—Å—á–µ—Ä–ø—ã–≤–∞—é—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: main.py](#—Ç–æ—á–∫–∞-–≤—Ö–æ–¥–∞-mainpy)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
5. [–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–¥–µ—Ç–∞–ª—å–Ω–æ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
6. [–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫-–¥–∞–Ω–Ω—ã—Ö)
7. [–ó–∞–ø—É—Å–∫ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#–∑–∞–ø—É—Å–∫-–∏-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
8. [–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)

---

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**Graham Analyzer** - —ç—Ç–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ë–µ–Ω–¥–∂–∞–º–∏–Ω–∞ –ì—Ä—ç–º–∞ (value investing). –ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:

- **Backend** (Python/FastAPI) - REST API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö –∏ –∏—Ö –∞–Ω–∞–ª–∏–∑–∞
- **Frontend** (React/TypeScript) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (PostgreSQL) - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö API (Tinkoff Invest, MOEX)
2. –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. –ê–Ω–∞–ª–∏–∑ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä–∞–º (P/E, P/B, ROE –∏ –¥—Ä.)
4. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–π: –Ω–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω–Ω—ã–µ, —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ, –ø–µ—Ä–µ–æ—Ü–µ–Ω–µ–Ω–Ω—ã–µ

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
graham-analyzer/
‚îú‚îÄ‚îÄ backend/                    # Backend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Python/FastAPI)
‚îÇ   ‚îú‚îÄ‚îÄ app/                    # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py         # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py             # ‚≠ê –¢–û–ß–ö–ê –í–•–û–î–ê - —Å–æ–∑–¥–∞–Ω–∏–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (SQLAlchemy)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas.py          # Pydantic —Å—Ö–µ–º—ã (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/             # SQLAlchemy –º–æ–¥–µ–ª–∏ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –ë–î)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ company.py      # –ú–æ–¥–µ–ª—å Company (—Ç–∞–±–ª–∏—Ü–∞ companies)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routers/            # API —Ä–æ—É—Ç–µ—Ä—ã (—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ companies_router.py  # –†–æ—É—Ç–µ—Ä –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π –∏–∑ Tinkoff
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ companies.py         # –†–æ—É—Ç–µ—Ä –¥–ª—è —Ü–µ–Ω–Ω—ã—Ö –±—É–º–∞–≥ (MOEX)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ company_service.py   # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ graham_analyser.py   # –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ì—Ä—ç–º–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sync_service.py      # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/              # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tinkoff_client.py    # –ö–ª–∏–µ–Ω—Ç –¥–ª—è Tinkoff Invest API
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ moex_client.py       # –ö–ª–∏–µ–Ω—Ç –¥–ª—è MOEX API
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ data/               # –ú–æ–∫-–¥–∞–Ω–Ω—ã–µ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ mock_data.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ alembic/                # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ venv/                    # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îÇ   ‚îî‚îÄ‚îÄ alembic.ini             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îÇ
‚îî‚îÄ‚îÄ frontend/                    # Frontend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (React/TypeScript)
    ‚îú‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ package.json
    ‚îî‚îÄ‚îÄ ...
```

---

## üöÄ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: main.py

### –ß—Ç–æ —Ç–∞–∫–æ–µ main.py?

`main.py` - —ç—Ç–æ **–≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –≠—Ç–æ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –≤—Å–µ–≥–æ backend.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

```python
# 1. –ò–º–ø–æ—Ä—Ç—ã
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.routers import companies, companies_router

# 2. –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
app = FastAPI(title='Graham Analyzer')

# 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS (–¥–ª—è —Ä–∞–±–æ—Ç—ã —Å frontend)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # –†–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã —Å frontend
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# 4. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ (—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ API)
app.include_router(companies.router)          # /securities/*
app.include_router(companies_router.router)   # /companies/*

# 5. –ü—Ä–æ—Å—Ç–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
@app.get('/health')
def health_check():
    return {'status': 'ok'}
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ?

1. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –º–æ–¥—É–ª–∏** - Python –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã
2. **–°–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `app`** - —ç—Ç–æ —ç–∫–∑–µ–º–ø–ª—è—Ä FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è CORS** - —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∑–∞–ø—Ä–æ—Å—ã —Å frontend
4. **–ü–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —Ä–æ—É—Ç–µ—Ä—ã** - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤—Å–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
5. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ** - –º–æ–∂–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP –∑–∞–ø—Ä–æ—Å—ã

### –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è?

```bash
# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
uvicorn app.main:app --reload

# –†–∞–∑–±–æ—Ä –∫–æ–º–∞–Ω–¥—ã:
# - uvicorn - ASGI —Å–µ—Ä–≤–µ—Ä (–∑–∞–ø—É—Å–∫–∞–µ—Ç FastAPI)
# - app.main - –ø—É—Ç—å –∫ –º–æ–¥—É–ª—é (app/main.py)
# - app - –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
# - --reload - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
```

**–í–∞–∂–Ω–æ:** `app.main:app` –æ–∑–Ω–∞—á–∞–µ—Ç:
- `app` - –ø–∞–∫–µ—Ç (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `app/`)
- `main` - –º–æ–¥—É–ª—å (—Ñ–∞–π–ª `main.py`)
- `app` - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (–æ–±—ä–µ–∫—Ç `FastAPI`)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ **MVC (Model-View-Controller)** —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ **Layered Architecture**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    HTTP Request                          ‚îÇ
‚îÇ              (GET /companies, POST /sync)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ROUTERS (routers/)                                      ‚îÇ
‚îÇ  - –ü—Ä–∏–Ω–∏–º–∞—é—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã                                ‚îÇ
‚îÇ  - –í–∞–ª–∏–¥–∏—Ä—É—é—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (schemas)                  ‚îÇ
‚îÇ  - –í—ã–∑—ã–≤–∞—é—Ç —Å–µ—Ä–≤–∏—Å—ã                                      ‚îÇ
‚îÇ  - –í–æ–∑–≤—Ä–∞—â–∞—é—Ç HTTP –æ—Ç–≤–µ—Ç—ã                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SERVICES (services/)                                    ‚îÇ
‚îÇ  - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞                                         ‚îÇ
‚îÇ  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö                                      ‚îÇ
‚îÇ  - –í—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö API (utils/)                           ‚îÇ
‚îÇ  - –†–∞–±–æ—Ç–∞ —Å –ë–î —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª–∏                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MODELS          ‚îÇ    ‚îÇ  UTILS           ‚îÇ
‚îÇ  (models/)       ‚îÇ    ‚îÇ  (utils/)        ‚îÇ
‚îÇ  - SQLAlchemy    ‚îÇ    ‚îÇ  - API –∫–ª–∏–µ–Ω—Ç—ã   ‚îÇ
‚îÇ  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î  ‚îÇ    ‚îÇ  - –í—Å–ø–æ–º–æ–≥–∞—Ç.    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  DATABASE (PostgreSQL)                                   ‚îÇ
‚îÇ  - –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìö –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. config.py - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ë–î, API –∫–ª—é—á–∏, –∏ —Ç.–¥.)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```python
# –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv(dotenv_path=ENV_FILE)

class Settings(BaseSettings):
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    POSTGRES_USER: str = "graham_user"
    POSTGRES_PASSWORD: str = "12345678"
    POSTGRES_DB: str = "graham_analyzer"
    POSTGRES_HOST: str = "localhost"
    POSTGRES_PORT: int = 5432
    
    # API –∫–ª—é—á–∏
    TINKOFF_TOKEN: str = "your_token_here"
    
    # –ú–µ—Ç–æ–¥ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è URL –ë–î
    @property
    def database_url(self) -> str:
        return f"postgresql://{self.POSTGRES_USER}:{self.POSTGRES_PASSWORD}@{self.POSTGRES_HOST}:{self.POSTGRES_PORT}/{self.POSTGRES_DB}"

# –°–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ (singleton)
settings = Settings()
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö: `from app.config import settings`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î, API –∫–ª—é—á–µ–π –∏ —Ç.–¥.

---

### 2. database.py - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SQLAlchemy –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```python
# 1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–≤–∏–∂–∫–∞ (engine) - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
engine = create_engine(
    settings.database_url,  # URL –∏–∑ config.py
    echo=True  # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç SQL –∑–∞–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
)

# 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫–∏ —Å–µ—Å—Å–∏–π
SessionLocal = sessionmaker(
    autocommit=False,
    autoflush=False,
    bind=engine
)

# 3. –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –º–æ–¥–µ–ª–µ–π
Base = declarative_base()

# 4. –§—É–Ω–∫—Ü–∏—è-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –ë–î
def get_db():
    db = SessionLocal()
    try:
        yield db  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Å—Å–∏—é
    finally:
        db.close()  # –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```

**–ß—Ç–æ —Ç–∞–∫–æ–µ —Å–µ—Å—Å–∏—è?**
- –°–µ—Å—Å–∏—è - —ç—Ç–æ "–æ–∫–Ω–æ" –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ß–µ—Ä–µ–∑ —Å–µ—Å—Å–∏—é –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (SELECT, INSERT, UPDATE, DELETE)
- –ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏—é –Ω—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ FastAPI:**
```python
# –í —Ä–æ—É—Ç–µ—Ä–µ
@router.get("/companies")
def get_companies(db: Session = Depends(get_db)):
    # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç get_db()
    # –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –≤ —Ñ—É–Ω–∫—Ü–∏—é
    companies = db.query(Company).all()
    return companies
```

---

### 3. models/company.py - –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã `companies` –≤ –ë–î

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```python
class Company(Base):  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç Base (–∏–∑ database.py)
    __tablename__ = "companies"  # –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
    
    # –ü–æ–ª—è —Ç–∞–±–ª–∏—Ü—ã
    id: Mapped[int] = mapped_column(Integer, primary_key=True)
    figi: Mapped[str] = mapped_column(String, unique=True)
    ticker: Mapped[str] = mapped_column(String)
    name: Mapped[str] = mapped_column(String)
    isin: Mapped[Optional[str]] = mapped_column(String)
    # ... –∏ —Ç.–¥.
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç SQLAlchemy:**
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Python –∫–ª–∞—Å—Å –≤ SQL —Ç–∞–±–ª–∏—Ü—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å—ã
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

**–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:**
–¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **–º–∏–≥—Ä–∞—Ü–∏–∏ Alembic** (–Ω–µ –≤—Ä—É—á–Ω—É—é):
```bash
alembic revision --autogenerate -m "create companies table"
alembic upgrade head
```

---

### 4. schemas.py - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö API

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```python
# –°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (–≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
class CompanyCreate(BaseModel):
    figi: str
    ticker: str
    name: str
    isin: str
    sector: Optional[str] = None
    # ...

# –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ API (–≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
class Company(BaseModel):
    figi: str
    ticker: str
    name: str
    # ...
```

**–ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å—Ö–µ–º—ã?**
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Swagger/OpenAPI
3. **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ IDE

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
@router.post("/companies")
def create_company(company_data: CompanyCreate):  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
    # company_data —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã
    ...
```

---

### 5. routers/ - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

#### companies_router.py - –†–æ—É—Ç–µ—Ä –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π (Tinkoff)

```python
router = APIRouter(prefix="/companies", tags=["companies"])

@router.get("/", response_model=list[Company])
def get_companies(skip: int = 0, limit: int = 200, db: Session = Depends(get_db)):
    """
    GET /companies/
    –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π –∏–∑ –ë–î
    """
    companies = get_all_companies(db, skip=skip, limit=limit)
    return companies

@router.post("/sync")
def sync_companies(db: Session = Depends(get_db)):
    """
    POST /companies/sync
    –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ Tinkoff API –≤ –ë–î
    """
    stats = sync_companies_from_tinkoff(db)
    return {"status": "success", "statistics": stats}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å: `GET http://localhost:8000/companies/`
2. FastAPI –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–æ—É—Ç–µ—Ä
3. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `get_companies()`
4. –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç —Å–µ—Å—Å–∏—é –ë–î —á–µ—Ä–µ–∑ `Depends(get_db)`
5. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å `get_all_companies()`
6. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è JSON –æ—Ç–≤–µ—Ç

#### companies.py - –†–æ—É—Ç–µ—Ä –¥–ª—è —Ü–µ–Ω–Ω—ã—Ö –±—É–º–∞–≥ (MOEX)

```python
router = APIRouter(prefix="/securities", tags=["securities"])

@router.get("/", response_model=list[Security])
def get_securities():
    """
    GET /securities/
    –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ü–µ–Ω–Ω—ã—Ö –±—É–º–∞–≥ —Å MOEX
    """
    securities = get_moex_securities()  # –í—ã–∑–æ–≤ —É—Ç–∏–ª–∏—Ç—ã
    return securities

@router.get('/analysis', response_model=AnalysisResponse)
def get_analysis_companies():
    """
    GET /securities/analysis
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏—Ö
    """
    # –ü–æ–ª—É—á–∞–µ—Ç —Ü–µ–Ω–Ω—ã–µ –±—É–º–∞–≥–∏
    securities = get_securities()
    
    # –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏:
    for security in securities:
        multipliers = _get_multipliers_by_company_id(security['id'])
        category = classify_company(multipliers)  # –ê–Ω–∞–ª–∏–∑
        
        # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        if category['classify'] == "undervalued":
            undervalued_companies.append(...)
        # ...
    
    return {
        "undervalued": undervalued_companies,
        "stable": stable_companies,
        "overvalued": overvalued_companies
    }
```

---

### 6. services/ - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

#### company_service.py - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏ –≤ –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

```python
# 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ ISIN
def get_company_by_isin(db: Session, isin: str) -> Optional[Company]:
    return db.query(Company).filter(Company.isin == isin).first()

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
def create_company(db: Session, company_data: CompanyCreate) -> Company:
    db_company = Company(
        figi=company_data.figi,
        ticker=company_data.ticker,
        # ...
    )
    db.add(db_company)      # –î–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–µ—Å—Å–∏—é
    db.commit()             # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
    db.refresh(db_company)  # –û–±–Ω–æ–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –ë–î
    return db_company

# 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
def update_company(db: Session, isin: str, company_data: CompanyCreate):
    db_company = get_company_by_isin(db, isin)
    if not db_company:
        return None
    
    db_company.ticker = company_data.ticker  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
    # ...
    db.commit()  # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    return db_company

# 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—Å–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å)
def sync_company(db: Session, company_data: CompanyCreate) -> Company:
    existing = get_company_by_isin(db, company_data.isin)
    if existing:
        return update_company(db, company_data.isin, company_data)
    else:
        return create_company(db, company_data)
```

**–í–∞–∂–Ω–æ:**
- `db.add()` - –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç –≤ —Å–µ—Å—Å–∏—é (–Ω–æ –µ—â–µ –Ω–µ –≤ –ë–î!)
- `db.commit()` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î
- `db.refresh()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î (–ø–æ–ª—É—á–∞–µ—Ç ID, timestamps –∏ —Ç.–¥.)

#### graham_analyser.py - –ê–Ω–∞–ª–∏–∑ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ì—Ä—ç–º–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä–æ–≤

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```python
def classify_company(multipliers):
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä—ã –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–æ–º–ø–∞–Ω–∏—é:
    - undervalued (–Ω–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω–Ω–∞—è)
    - stable (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è)
    - overvalued (–ø–µ—Ä–µ–æ—Ü–µ–Ω–µ–Ω–Ω–∞—è)
    """
    pe = multipliers['pe_ratio']           # P/E (—Ü–µ–Ω–∞/–ø—Ä–∏–±—ã–ª—å)
    pb = multipliers['pb_ratio']           # P/B (—Ü–µ–Ω–∞/–±–∞–ª–∞–Ω—Å–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å)
    debt_to_equity = multipliers['debt_to_equity']  # –î–æ–ª–≥/–∫–∞–ø–∏—Ç–∞–ª
    current_ratio = multipliers['current_ratio']    # –¢–µ–∫—É—â–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
    roe = multipliers['roe']               # ROE (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–ø–∏—Ç–∞–ª–∞)
    dividend_yield = multipliers['dividend_yield'] # –î–∏–≤–∏–¥–µ–Ω–¥–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    
    # –û—Ü–µ–Ω–∫–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è
    pe_ratio_status = _evaluate_status(pe, 15, 25, is_higher_better=False)
    pb_ratio_status = _evaluate_status(pb, 1.5, 3.0, is_higher_better=False)
    # ...
    
    # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
    is_undervalued = (
        pe < 15 and 
        pb < 1.5 and 
        debt_to_equity <= 0.5 and 
        current_ratio > 2.0 and 
        roe > 15 and 
        dividend_yield > 3
    )
    
    if is_undervalued:
        classify = "undervalued"
    elif is_stable:
        classify = "stable"
    else:
        classify = "overvalued"
    
    return {
        "classify": classify,
        "pe_ratio_status": pe_ratio_status,
        # ...
    }
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ì—Ä—ç–º–∞:**
- **P/E < 15** - –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ–¥–æ—Ä–æ–≥–∞—è
- **P/B < 1.5** - —Ü–µ–Ω–∞ –Ω–∏–∂–µ –±–∞–ª–∞–Ω—Å–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- **–î–æ–ª–≥/–ö–∞–ø–∏—Ç–∞–ª ‚â§ 0.5** - –Ω–∏–∑–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å
- **–¢–µ–∫—É—â–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å > 2.0** - —Ö–æ—Ä–æ—à–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
- **ROE > 15%** - –≤—ã—Å–æ–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
- **–î–∏–≤–∏–¥–µ–Ω–¥—ã > 3%** - —Ö–æ—Ä–æ—à–∏–µ –¥–∏–≤–∏–¥–µ–Ω–¥—ã

#### sync_service.py - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –∏–∑ Tinkoff API –≤ –ë–î

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```python
def sync_companies_from_tinkoff(db: Session) -> Dict[str, int]:
    """
    1. –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ Tinkoff API
    2. –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏:
       - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –≤ –ë–î
       - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é
    3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    """
    # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
    tinkoff_companies = get_tinkoff_companies()
    
    stats = {
        'total': len(tinkoff_companies),
        'created': 0,
        'updated': 0,
        'errors': 0
    }
    
    # 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
    for company_dict in tinkoff_companies:
        try:
            # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ö–µ–º—É
            company_data = CompanyCreate(
                figi=company_dict['figi'],
                ticker=company_dict['ticker'],
                # ...
            )
            
            # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—Å–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å)
            sync_company(db, company_data)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            if was_existing:
                stats['updated'] += 1
            else:
                stats['created'] += 1
        except Exception as e:
            stats['errors'] += 1
    
    return stats
```

---

### 7. utils/ - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

#### tinkoff_client.py - –ö–ª–∏–µ–Ω—Ç Tinkoff Invest API

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö –∏–∑ Tinkoff Invest API

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```python
def get_tinkoff_companies() -> List[Dict]:
    """
    1. –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –∫ Tinkoff API
    3. –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
    4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π
    """
    token = os.getenv('TINKOFF_TOKEN')
    
    # URL API
    url = "https://invest-public-api.tinkoff.ru/rest/tinkoff.public.invest.api.contract.v1.InstrumentsService/Shares"
    
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }
    
    payload = {
        "instrument_status": "INSTRUMENT_STATUS_BASE"
    }
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
    response = requests.post(url, json=payload, headers=headers)
    data = response.json()
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
    instruments = data.get('instruments', [])
    
    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
    companies = []
    for instrument in instruments:
        is_russian = (
            instrument.get('isin', '').startswith('RU') or
            instrument.get('countryOfRisk') == 'RU' or
            instrument.get('currency') == 'RUB'
        )
        
        if is_russian:
            companies.append({
                'figi': instrument.get('figi'),
                'ticker': instrument.get('ticker'),
                'name': instrument.get('name'),
                # ...
            })
    
    return companies
```

#### moex_client.py - –ö–ª–∏–µ–Ω—Ç MOEX API

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ü–µ–Ω–Ω—ã—Ö –±—É–º–∞–≥–∞—Ö —Å –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```python
def get_moex_securities() -> List[Dict]:
    """
    1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç GET –∑–∞–ø—Ä–æ—Å –∫ MOEX API
    2. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ü–µ–Ω–Ω—ã—Ö –±—É–º–∞–≥
    3. –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ü–∏–∏ (INSTRID='EQIN')
    4. –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∫–ª—é—á–∏ (UPPERCASE -> lowercase)
    5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫
    """
    url = "https://iss.moex.com/iss/engines/stock/markets/shares/securities.json"
    
    response = requests.get(url)
    data = response.json()
    
    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    securities = data.get('securities', {})
    columns = securities.get('columns', [])
    rows = securities.get('data', [])
    
    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
    companies = []
    for row in rows:
        # –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ –∞–∫—Ü–∏–∏
        if row[instrid_idx] == 'EQIN':
            company = dict(zip(columns, row))
            # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–π
            normalized = {k.lower(): v for k, v in company.items()}
            companies.append(normalized)
    
    return companies
```

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π

```
1. –ö–ª–∏–µ–Ω—Ç (Frontend/Browser)
   ‚Üì
   GET http://localhost:8000/companies/
   
2. FastAPI (main.py)
   ‚Üì
   –ù–∞—Ö–æ–¥–∏—Ç —Ä–æ—É—Ç–µ—Ä: companies_router.py
   
3. –†–æ—É—Ç–µ—Ä (companies_router.py)
   ‚Üì
   @router.get("/")
   def get_companies(db: Session = Depends(get_db))
   
4. Dependency Injection (database.py)
   ‚Üì
   get_db() —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –ë–î
   
5. –°–µ—Ä–≤–∏—Å (company_service.py)
   ‚Üì
   get_all_companies(db)
   
6. SQLAlchemy (models/company.py)
   ‚Üì
   db.query(Company).all()
   ‚Üí SQL: SELECT * FROM companies
   
7. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
   ‚Üì
   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
   
8. –û–±—Ä–∞—Ç–Ω—ã–π –ø—É—Ç—å
   ‚Üì
   Company –æ–±—ä–µ–∫—Ç—ã ‚Üí Pydantic —Å—Ö–µ–º—ã ‚Üí JSON ‚Üí HTTP Response
   
9. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç JSON
   [
     {
       "figi": "BBG004730N88",
       "ticker": "SBER",
       "name": "–°–±–µ—Ä–±–∞–Ω–∫",
       ...
     },
     ...
   ]
```

### –ü—Ä–∏–º–µ—Ä 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–π

```
1. –ö–ª–∏–µ–Ω—Ç
   ‚Üì
   POST http://localhost:8000/companies/sync
   
2. –†–æ—É—Ç–µ—Ä (companies_router.py)
   ‚Üì
   @router.post("/sync")
   def sync_companies(db: Session = Depends(get_db))
   
3. –°–µ—Ä–≤–∏—Å (sync_service.py)
   ‚Üì
   sync_companies_from_tinkoff(db)
   
4. –£—Ç–∏–ª–∏—Ç–∞ (tinkoff_client.py)
   ‚Üì
   get_tinkoff_companies()
   ‚Üí HTTP –∑–∞–ø—Ä–æ—Å –∫ Tinkoff API
   ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π
   
5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
   ‚Üì
   –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏:
     - CompanyCreate —Å—Ö–µ–º–∞
     - sync_company(db, company_data)
   
6. –°–µ—Ä–≤–∏—Å (company_service.py)
   ‚Üì
   sync_company() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
   ‚Üí create_company() –∏–ª–∏ update_company()
   
7. SQLAlchemy
   ‚Üì
   db.add() ‚Üí db.commit()
   ‚Üí SQL: INSERT –∏–ª–∏ UPDATE
   
8. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
   ‚Üì
   –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   
9. –í–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   ‚Üì
   {
     "status": "success",
     "statistics": {
       "total": 150,
       "created": 120,
       "updated": 30,
       "errors": 0
     }
   }
```

### –ü—Ä–∏–º–µ—Ä 3: –ê–Ω–∞–ª–∏–∑ –∫–æ–º–ø–∞–Ω–∏–π

```
1. –ö–ª–∏–µ–Ω—Ç
   ‚Üì
   GET http://localhost:8000/securities/analysis
   
2. –†–æ—É—Ç–µ—Ä (companies.py)
   ‚Üì
   @router.get('/analysis')
   def get_analysis_companies()
   
3. –£—Ç–∏–ª–∏—Ç–∞ (moex_client.py)
   ‚Üì
   get_moex_securities()
   ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω–Ω—ã—Ö –±—É–º–∞–≥ —Å MOEX
   
4. –î–ª—è –∫–∞–∂–¥–æ–π —Ü–µ–Ω–Ω–æ–π –±—É–º–∞–≥–∏:
   ‚Üì
   a) –ü–æ–ª—É—á–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä–æ–≤ (mock_data.py)
   b) –ê–Ω–∞–ª–∏–∑ (graham_analyser.py)
      ‚Üì
      classify_company(multipliers)
      ‚Üí –û—Ü–µ–Ω–∫–∞ P/E, P/B, ROE –∏ –¥—Ä.
      ‚Üí –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: undervalued/stable/overvalued
   
5. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   ‚Üì
   {
     "undervalued": [...],
     "stable": [...],
     "overvalued": [...]
   }
   
6. –í–æ–∑–≤—Ä–∞—Ç –∫–ª–∏–µ–Ω—Ç—É
```

---

## üöÄ –ó–∞–ø—É—Å–∫ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cd backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows

# 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
TINKOFF_TOKEN=your_actual_token_here
POSTGRES_USER=graham_user
POSTGRES_PASSWORD=12345678
POSTGRES_DB=graham_analyzer
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ –ë–î (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞)
createdb graham_analyzer

# 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
cd backend
alembic upgrade head
```

### 3. –ó–∞–ø—É—Å–∫ backend

```bash
cd backend
source venv/bin/activate
uvicorn app.main:app --reload

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞:
# - API: http://127.0.0.1:8000
# - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://127.0.0.1:8000/docs
# - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://127.0.0.1:8000/redoc
```

### 4. –ó–∞–ø—É—Å–∫ frontend

```bash
cd frontend
npm install  # –ü–µ—Ä–≤—ã–π —Ä–∞–∑
npm start

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞:
# http://localhost:3000
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API
curl http://localhost:8000/health
# –û—Ç–≤–µ—Ç: {"status":"ok"}

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π
curl http://localhost:8000/companies/

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–π
curl -X POST http://localhost:8000/companies/sync
```

---

## üîó –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

```
main.py
  ‚îú‚îÄ‚îÄ routers/companies_router.py
  ‚îÇ     ‚îú‚îÄ‚îÄ services/company_service.py
  ‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ models/company.py
  ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ database.py
  ‚îÇ     ‚îî‚îÄ‚îÄ services/sync_service.py
  ‚îÇ           ‚îú‚îÄ‚îÄ utils/tinkoff_client.py
  ‚îÇ           ‚îÇ     ‚îî‚îÄ‚îÄ config.py
  ‚îÇ           ‚îî‚îÄ‚îÄ services/company_service.py
  ‚îÇ
  ‚îî‚îÄ‚îÄ routers/companies.py
        ‚îú‚îÄ‚îÄ utils/moex_client.py
        ‚îú‚îÄ‚îÄ services/graham_analyser.py
        ‚îî‚îÄ‚îÄ data/mock_data.py
```

### –ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

1. **–ò–º–ø–æ—Ä—Ç config.py**
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç `settings`

2. **–ò–º–ø–æ—Ä—Ç database.py**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `settings.database_url`
   - –°–æ–∑–¥–∞–µ—Ç `engine` –∏ `SessionLocal`

3. **–ò–º–ø–æ—Ä—Ç models/**
   - –ú–æ–¥–µ–ª–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç `Base` (–∏–∑ database.py)
   - –û–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü

4. **–ò–º–ø–æ—Ä—Ç utils/**
   - –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç `config.settings` –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤

5. **–ò–º–ø–æ—Ä—Ç services/**
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–¥–µ–ª–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã
   - –°–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

6. **–ò–º–ø–æ—Ä—Ç routers/**
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Å–µ—Ä–≤–∏—Å—ã
   - –û–ø—Ä–µ–¥–µ–ª—è—é—Ç API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

7. **–ò–º–ø–æ—Ä—Ç main.py**
   - –°–æ–∑–¥–∞–µ—Ç FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–æ—É—Ç–µ—Ä—ã
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç CORS

8. **–ó–∞–ø—É—Å–∫ uvicorn**
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç HTTP —Å–µ—Ä–≤–µ—Ä
   - –ì–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã

---

## üìù –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### 1. Dependency Injection (DI)

FastAPI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```python
def get_companies(db: Session = Depends(get_db)):
    # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    # 1. –í—ã–∑—ã–≤–∞–µ—Ç get_db()
    # 2. –ü–æ–ª—É—á–∞–µ—Ç —Å–µ—Å—Å–∏—é –ë–î
    # 3. –ü–µ—Ä–µ–¥–∞–µ—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é
    # 4. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

### 2. ORM (Object-Relational Mapping)

SQLAlchemy - —ç—Ç–æ ORM, –∫–æ—Ç–æ—Ä—ã–π:
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Python –∫–ª–∞—Å—Å—ã –≤ SQL —Ç–∞–±–ª–∏—Ü—ã
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Python –æ–±—ä–µ–∫—Ç—ã –≤ SQL —Å—Ç—Ä–æ–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å—ã

```python
# –í–º–µ—Å—Ç–æ SQL:
# SELECT * FROM companies WHERE isin = 'RU0009029540'

# –ü–∏—à–µ–º –Ω–∞ Python:
company = db.query(Company).filter(Company.isin == 'RU0009029540').first()
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏–∏ (Alembic)

–ú–∏–≥—Ä–∞—Ü–∏–∏ - —ç—Ç–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "add new field"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade -1
```

### 4. CORS (Cross-Origin Resource Sharing)

CORS –ø–æ–∑–≤–æ–ª—è–µ—Ç frontend (localhost:3000) –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ backend (localhost:8000):

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## üéì –†–µ–∑—é–º–µ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–µ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:

1. **main.py** - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Å–æ–∑–¥–∞–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. **routers/** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã (API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
3. **services/** - —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (—á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏)
4. **models/** - –æ–ø–∏—Å—ã–≤–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü –ë–î
5. **utils/** - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (API –∫–ª–∏–µ–Ω—Ç—ã –∏ —Ç.–¥.)
6. **config.py** - –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
7. **database.py** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

### –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã:

1. **HTTP –∑–∞–ø—Ä–æ—Å** ‚Üí —Ä–æ—É—Ç–µ—Ä
2. **–†–æ—É—Ç–µ—Ä** ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å
3. **–°–µ—Ä–≤–∏—Å** ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ë–î —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç —É—Ç–∏–ª–∏—Ç—ã
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä –∫–∞–∫ JSON

### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç—ã
- FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã
- SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL
- Pydantic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
- Dependency Injection –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [FastAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://fastapi.tiangolo.com/)
- [SQLAlchemy –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.sqlalchemy.org/)
- [Pydantic –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.pydantic.dev/)
- [Alembic –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://alembic.sqlalchemy.org/)

---

**–ê–≤—Ç–æ—Ä:** –ò–ò-–∞–≥–µ–Ω—Ç  
**–î–∞—Ç–∞:** 2025  
**–í–µ—Ä—Å–∏—è:** 1.0
